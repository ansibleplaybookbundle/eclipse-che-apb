FROM ansibleplaybookbundle/apb-base:nightly

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGVjbGlwc2UtY2hlLWFwYgpkZXNjcmlwdGlvbjogRWNsaXBzZSBD\
aGUKYmluZGFibGU6IGZhbHNlCmFzeW5jOiBvcHRpb25hbAptZXRhZGF0YToKICBwcm92aWRlckRp\
c3BsYXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKICBkb2N1bWVudGF0aW9uVXJsOiAiaHR0cHM6Ly93\
d3cuZWNsaXBzZS5vcmcvY2hlL2RvY3MvNi9jaGUvZG9jcy8iCiAgaW1hZ2VVcmw6ID4tCiAgICBo\
dHRwczovL2dpdGh1Yi5jb20vZWNsaXBzZS9jaGUtZG9jcy9yYXcvbWFzdGVyL3NyYy9tYWluL2lt\
YWdlcy9jaGVfbG9nby5wbmcKICBsb25nRGVzY3JpcHRpb246ICJBbiBBUEIgdGhhdCBkZXBsb3lz\
IEVjbGlwc2UgQ2hlIHY2Lnggd2l0aCBwZXJzaXN0ZW50IHN0b3JhZ2UuIFJlcXVpcmVkIC0gUGVy\
c2lzdGVudCBWb2x1bWVzLCBBU0IgY29uZmlndXJlZCB3aXRoIHNhbmRib3hfcm9sZSBhZG1pbi4g\
VW5zdXBwb3J0ZWQgLSBUTFMsIEVwaGVtZXJhbCBzdG9yYWdlLiBBbGwgdGhlIHBhcmFtZXRlcnMg\
YXJlIGRlZmF1bHRlZCB3aXRoIHR5cGljYWwgY29uZmlndXJlZCB2YWx1ZXMuIgogIGRpc3BsYXlO\
YW1lOiAiRWNsaXBzZSBDaGUgKEFQQikiCiAgZGVwZW5kZW5jaWVzOgogICAgLSAiZG9ja2VyLmlv\
L2VjbGlwc2UvY2hlLXNlcnZlcjpuaWdodGx5IgogICAgLSAiZG9ja2VyLmlvL2pib3NzL2tleWNs\
b2FrLW9wZW5zaGlmdDozLjQuMy5GaW5hbCIKICAgIC0gImRvY2tlci5pby9yaHNjbC9wb3N0Z3Jl\
c3FsLTk2LXJoZWw3OmxhdGVzdCIKcGxhbnM6CiAgLSBuYW1lOiBwcm9kCiAgICBkZXNjcmlwdGlv\
bjogUGVyc2lzdGVudCBkZXBsb3ltZW50IG9mIEVjbGlwc2UgQ2hlCiAgICBmcmVlOiB0cnVlCiAg\
ICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IFByb2R1Y3Rpb24KICAgICAgbG9uZ0Rlc2Ny\
aXB0aW9uOiAiVGhpcyBwbGFuIGRlcGxveXMgRWNsaXBzZSBDaGUgd2l0aCBwZXJzaXN0ZW50IHN0\
b3JhZ2UuIEFsbCB0aGUgcGFyYW1ldGVycyBhcmUgZGVmYXVsdGVkIHdpdGggdHlwaWNhbCBjb25m\
aWd1cmVkIHZhbHVlcy4iCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6ICJjaGVfcHJlZGVm\
aW5lZF9zdGFja3NfcmVsb2FkX19vbl9fc3RhcnQiCiAgICAgICAgdGl0bGU6ICJTdGFjayByZWxv\
YWQgb24gc3RhcnQiCiAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAgIGRlZmF1bHQ6IHRydWUK\
ICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dyb3VwOiBDaGUgQ29uZmln\
dXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfd29ya3NwYWNlX2F1dG9fc3RhcnQiCiAgICAgICAg\
dGl0bGU6ICJXb3Jrc3BhY2UgYXV0byBzdGFydCIKICAgICAgICB0eXBlOiBib29sZWFuCiAgICAg\
ICAgZGVmYXVsdDogZmFsc2UKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkaXNwbGF5\
X2dyb3VwOiBDaGUgQ29uZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfamRiY19kYl9ob3N0\
IgogICAgICAgIHRpdGxlOiBEYXRhYmFzZSBob3N0CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogInBvc3RncmVzIgogICAgICAgIGRp\
c3BsYXlfZ3JvdXA6IFBvc3RncmVTUUwgRGF0YWJhc2UgQ29uZmlndXJhdGlvbgogICAgICAtIG5h\
bWU6ICJjaGVfamRiY19kYl9wb3J0IgogICAgICAgIHRpdGxlOiBEYXRhYmFzZSBwb3J0CiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDog\
IjU0MzIiCiAgICAgICAgZGlzcGxheV9ncm91cDogUG9zdGdyZVNRTCBEYXRhYmFzZSBDb25maWd1\
cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9qZGJjX2RiX25hbWUiCiAgICAgICAgdGl0bGU6IERh\
dGFiYXNlIG5hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UK\
ICAgICAgICBkZWZhdWx0OiAiZGJjaGUiCiAgICAgICAgZGlzcGxheV9ncm91cDogUG9zdGdyZVNR\
TCBEYXRhYmFzZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9qZGJjX2RiX3VzZXJu\
YW1lIgogICAgICAgIHRpdGxlOiBEYXRhYmFzZSB1c2VybmFtZQogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJwZ2NoZSIKICAgICAg\
ICBkaXNwbGF5X2dyb3VwOiBQb3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3VyYXRpb24KICAgICAg\
LSBuYW1lOiAiY2hlX2pkYmNfZGJfcGFzc3dvcmQiCiAgICAgICAgdGl0bGU6IERhdGFiYXNlIHBh\
c3N3b3JkIChzZXQgdG8gZGVmYXVsdCBwZ2NoZXBhc3N3b3JkKQogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJwZ2NoZXBhc3N3b3Jk\
IgogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQ\
b3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAiY2hlX2RhdGFf\
cHZjX3F1YW50aXR5IgogICAgICAgIHRpdGxlOiAiQ2hlIHNlcnZlciBkYXRhIHZvbHVtZSBzaXpl\
IgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRl\
ZmF1bHQ6ICIxR2kiCiAgICAgICAgZGlzcGxheV9ncm91cDogUGVyc2lzdGVudCBWb2x1bWUKICAg\
ICAgLSBuYW1lOiAiY2hlX2luZnJhX2t1YmVybmV0ZXNfcHZjX3ByZWNyZWF0ZV9fc3VicGF0aHMi\
CiAgICAgICAgdGl0bGU6IFByZWNyZWF0ZSBTdWJwYXRocwogICAgICAgIHR5cGU6IGJvb2xlYW4K\
ICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiB0cnVlCiAgICAgICAgZGlz\
cGxheV9ncm91cDogUGVyc2lzdGVudCBWb2x1bWUKICAgICAgLSBuYW1lOiAiY2hlX2luZnJhX2t1\
YmVybmV0ZXNfcHZjX3F1YW50aXR5IgogICAgICAgIHRpdGxlOiBEaXNrIHF1YW50aXR5IGZvciBj\
aGUgd29ya3NwYWNlCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNl\
CiAgICAgICAgZGVmYXVsdDogIjFHaSIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQZXJzaXN0ZW50\
IFZvbHVtZQogICAgICAtIG5hbWU6ICJjaGVfaW5mcmFfa3ViZXJuZXRlc19wdmNfc3RyYXRlZ3ki\
CiAgICAgICAgdGl0bGU6IENvbW1vbiBvciB1bmlxdWUgdm9sdW1lIGZvciB3b3Jrc3BhY2UKICAg\
ICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWyd1bmlxdWUnLCAnY29tbW9uJ10KICAgICAg\
ICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAidW5pcXVlIgogICAgICAgIGRpc3Bs\
YXlfZ3JvdXA6IFBlcnNpc3RlbnQgVm9sdW1lCiAgICAgIC0gbmFtZTogImNoZV9pbmZyYV9rdWJl\
cm5ldGVzX3B2Y19uYW1lIgogICAgICAgIHRpdGxlOiBXb3Jrc3BhY2UgVm9sdW1lIE5hbWUgKG9u\
bHkgaWYgc3RyYXRlZ3kgaXMgY29tbW9uKQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJl\
cXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICIiCiAgICAgICAgZGlzcGxheV9ncm91cDog\
UGVyc2lzdGVudCBWb2x1bWUKICAgICAgLSBuYW1lOiAiY2hlX2RlYnVnX3NlcnZlciIKICAgICAg\
ICB0aXRsZTogRW5hYmxlIENoZSBEZWJ1Z2dpbmcKICAgICAgICB0eXBlOiBib29sZWFuCiAgICAg\
ICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICBkaXNwbGF5\
X2dyb3VwOiBEZWJ1ZwogICAgICAtIG5hbWU6ICJjaGVfbG9nX2xldmVsIgogICAgICAgIHRpdGxl\
OiAiQ2hlIExvZyBMZXZlbCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDog\
ZmFsc2UKICAgICAgICBkZWZhdWx0OiAiSU5GTyIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBEZWJ1\
ZwoK"




COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb} && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'persistent'/'prod'/g" && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'ephemeral'/'dev'/g"

USER apb

