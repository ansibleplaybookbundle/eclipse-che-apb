FROM ansibleplaybookbundle/apb-base:canary

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBlY2xpcHNlLWNoZS1hcGIKZGVzY3JpcHRpb246IEVjbGlw\
c2UgQ2hlCmJpbmRhYmxlOiBmYWxzZQphc3luYzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgcHJvdmlk\
ZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHBz\
Oi8vd3d3LmVjbGlwc2Uub3JnL2NoZS9kb2NzLyIKICBpbWFnZVVybDogPi0KICAgIGh0dHBzOi8v\
Z2l0aHViLmNvbS9lY2xpcHNlL2NoZS1kb2NzL3Jhdy9tYXN0ZXIvc3JjL21haW4vaW1hZ2VzL2No\
ZV9sb2dvLnBuZwogIGxvbmdEZXNjcmlwdGlvbjogIkFuIEFQQiBkZXBsb3lzIEVjbGlwc2UgQ2hl\
IHY2Lnggd2l0aCBwZXJzaXN0ZW50IHN0b3JhZ2UiCiAgZGlzcGxheU5hbWU6ICJFY2xpcHNlIENo\
ZSAoQVBCKSIKICBkZXBlbmRlbmNpZXM6CiAgICAtICJkb2NrZXIuaW8vZWNsaXBzZS9jaGUtc2Vy\
dmVyOm5pZ2h0bHkiCiAgICAtICJkb2NrZXIuaW8vamJvc3Mva2V5Y2xvYWstb3BlbnNoaWZ0OjMu\
NC4zLkZpbmFsIgogICAgLSAiZG9ja2VyLmlvL2NlbnRvcy9wb3N0Z3Jlc3FsLTk2LWNlbnRvczc6\
OS42IgpwbGFuczoKICAtIG5hbWU6IHByb2QKICAgIGRlc2NyaXB0aW9uOiBQZXJzaXN0ZW50IGRl\
cGxveW1lbnQgb2YgRWNsaXBzZSBDaGUKICAgIGZyZWU6IHRydWUKICAgIG1ldGFkYXRhOgogICAg\
ICBkaXNwbGF5TmFtZTogUHJvZHVjdGlvbgogICAgICBsb25nRGVzY3JpcHRpb246ICJUaGlzIHBs\
YW4gZGVwbG95cyBFY2xpcHNlIENoZSB3aXRoIHBlcnNpc3RlbnQgc3RvcmFnZS4iCiAgICBwYXJh\
bWV0ZXJzOgogICAgICAtIG5hbWU6ICJjaGVfaW1hZ2VfdGFnIgogICAgICAgIHRpdGxlOiBDaGUg\
U2VydmVyIEltYWdlIFRhZwogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBbIm5pZ2h0\
bHktY2VudG9zIiwgIm5pZ2h0bHkiLCAibGF0ZXN0LWNlbnRvcyIsICJsYXRlc3QiXQogICAgICAg\
IHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJuaWdodGx5IgogICAgICAgIGRpc3Bs\
YXlfZ3JvdXA6IENoZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9zZXJ2ZXJfZGVw\
bG95bWVudF9zdHJhZ2V0eSIKICAgICAgICB0aXRsZTogQ2hlIERlcGxveW1lbnQgU3RyYWdldHkK\
ICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWyJSZWNyZWF0ZSIsICJSb2xsaW5nIl0K\
ICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiUmVjcmVhdGUiCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogQ2hlIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAiY2hlX3Nl\
cnZlcl9pbWFnZV9wdWxsX3BvbGljeSIKICAgICAgICB0aXRsZTogIkNoZSBEZXBsb3ltZW50Q29u\
ZmlnIEltYWdlIHB1bGwgcG9saWN5IgogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBb\
IkFsd2F5cyIsICJJZk5vdFByZXNlbnQiLCAiTmV2ZXIiXQogICAgICAgIHJlcXVpcmVkOiBmYWxz\
ZQogICAgICAgIGRlZmF1bHQ6ICJJZk5vdFByZXNlbnQiCiAgICAgICAgZGlzcGxheV9ncm91cDog\
Q2hlIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAiY2hlX3ByZWRlZmluZWRfc3RhY2tzX3Jl\
bG9hZF9fb25fX3N0YXJ0IgogICAgICAgIHRpdGxlOiAiU3RhY2sgcmVsb2FkIG9uIHN0YXJ0Igog\
ICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICBkZWZhdWx0OiB0cnVlCiAgICAgICAgcmVxdWly\
ZWQ6IGZhbHNlCiAgICAgICAgZGlzcGxheV9ncm91cDogQ2hlIENvbmZpZ3VyYXRpb24KICAgICAg\
LSBuYW1lOiAiY2hlX3dvcmtzcGFjZV9hdXRvX3N0YXJ0IgogICAgICAgIHRpdGxlOiAiV29ya3Nw\
YWNlIGF1dG8gc3RhcnQiCiAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAgIGRlZmF1bHQ6IGZh\
bHNlCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGlzcGxheV9ncm91cDogQ2hlIENv\
bmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAiY2hlX2tleWNsb2FrX2FkbWluX3VzZXJuYW1lIgog\
ICAgICAgIHRpdGxlOiBLZXljbG9hayBBZG1pbiBVc2VybmFtZQogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJhZG1pbiIKICAgICAg\
ICBkaXNwbGF5X2dyb3VwOiBLZXljbG9hayBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNo\
ZV9rZXljbG9ha19hZG1pbl9wYXNzd29yZCIKICAgICAgICB0aXRsZTogS2V5Y2xvYWsgQWRtaW4g\
UGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAg\
ICAgICBkZWZhdWx0OiAiYWRtaW4iCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IEtleWNsb2FrIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAi\
Y2hlX2tleWNsb2FrX3JlYWxtIgogICAgICAgIHRpdGxlOiBDaGUgS2V5Y2xvYWsgUmVhbG0KICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBkZWZhdWx0OiAiY2hlIgogICAgICAgIHJlcXVpcmVk\
OiBmYWxzZQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEtleWNsb2FrIENvbmZpZ3VyYXRpb24KICAg\
ICAgLSBuYW1lOiAiY2hlX2tleWNsb2FrX2NsaWVudF9faWQiCiAgICAgICAgdGl0bGU6ICJDaGUg\
S2V5Y2xvYWsgQ2xpZW50IElkIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6\
ICJjaGUtcHVibGljIgogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IEtleWNsb2FrIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAiY2hlX2pkYmNfZGJfaG9z\
dCIKICAgICAgICB0aXRsZTogRGF0YWJhc2UgaG9zdAogICAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJwb3N0Z3JlcyIKICAgICAgICBk\
aXNwbGF5X2dyb3VwOiBQb3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3VyYXRpb24KICAgICAgLSBu\
YW1lOiAiY2hlX2pkYmNfZGJfcG9ydCIKICAgICAgICB0aXRsZTogRGF0YWJhc2UgcG9ydAogICAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6\
ICI1NDMyIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBvc3RncmVTUUwgRGF0YWJhc2UgQ29uZmln\
dXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfamRiY19kYl9uYW1lIgogICAgICAgIHRpdGxlOiBE\
YXRhYmFzZSBuYW1lCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNl\
CiAgICAgICAgZGVmYXVsdDogImRiY2hlIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBvc3RncmVT\
UUwgRGF0YWJhc2UgQ29uZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfamRiY19kYl91c2Vy\
bmFtZSIKICAgICAgICB0aXRsZTogRGF0YWJhc2UgdXNlcm5hbWUKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAicGdjaGUiCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogUG9zdGdyZVNRTCBEYXRhYmFzZSBDb25maWd1cmF0aW9uCiAgICAg\
IC0gbmFtZTogImNoZV9qZGJjX2RiX3Bhc3N3b3JkIgogICAgICAgIHRpdGxlOiBEYXRhYmFzZSBw\
YXNzd29yZCAoc2V0IHRvIGRlZmF1bHQgcGdjaGVwYXNzd29yZCkKICAgICAgICB0eXBlOiBzdHJp\
bmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAicGdjaGVwYXNzd29y\
ZCIKICAgICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgICAgZGlzcGxheV9ncm91cDog\
UG9zdGdyZVNRTCBEYXRhYmFzZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9kYXRh\
X3B2Y19xdWFudGl0eSIKICAgICAgICB0aXRsZTogIkNoZSBzZXJ2ZXIgZGF0YSB2b2x1bWUgc2l6\
ZSIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBk\
ZWZhdWx0OiAiMUdpIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBlcnNpc3RlbnQgVm9sdW1lCiAg\
ICAgIC0gbmFtZTogImNoZV9pbmZyYV9rdWJlcm5ldGVzX3B2Y19wcmVjcmVhdGVfX3N1YnBhdGhz\
IgogICAgICAgIHRpdGxlOiBQcmVjcmVhdGUgU3VicGF0aHMKICAgICAgICB0eXBlOiBib29sZWFu\
CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogdHJ1ZQogICAgICAgIGRp\
c3BsYXlfZ3JvdXA6IFBlcnNpc3RlbnQgVm9sdW1lCiAgICAgIC0gbmFtZTogImNoZV9pbmZyYV9r\
dWJlcm5ldGVzX3B2Y19xdWFudGl0eSIKICAgICAgICB0aXRsZTogRGlzayBxdWFudGl0eSBmb3Ig\
Y2hlIHdvcmtzcGFjZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxz\
ZQogICAgICAgIGRlZmF1bHQ6ICIxR2kiCiAgICAgICAgZGlzcGxheV9ncm91cDogUGVyc2lzdGVu\
dCBWb2x1bWUKICAgICAgLSBuYW1lOiAiY2hlX2luZnJhX2t1YmVybmV0ZXNfcHZjX3N0cmF0ZWd5\
IgogICAgICAgIHRpdGxlOiBDb21tb24gb3IgdW5pcXVlIHZvbHVtZSBmb3Igd29ya3NwYWNlCiAg\
ICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06IFsndW5pcXVlJywgJ2NvbW1vbiddCiAgICAg\
ICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogInVuaXF1ZSIKICAgICAgICBkaXNw\
bGF5X2dyb3VwOiBQZXJzaXN0ZW50IFZvbHVtZQogICAgICAtIG5hbWU6ICJjaGVfaW5mcmFfa3Vi\
ZXJuZXRlc19wdmNfbmFtZSIKICAgICAgICB0aXRsZTogV29ya3NwYWNlIFZvbHVtZSBOYW1lIChv\
bmx5IGlmIHN0cmF0ZWd5IGlzIGNvbW1vbikKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICBy\
ZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6\
IFBlcnNpc3RlbnQgVm9sdW1lCiAgICAgIC0gbmFtZTogImNoZV9kZWJ1Z19zZXJ2ZXIiCiAgICAg\
ICAgdGl0bGU6IEVuYWJsZSBDaGUgRGVidWdnaW5nCiAgICAgICAgdHlwZTogYm9vbGVhbgogICAg\
ICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICAgICAgZGlzcGxh\
eV9ncm91cDogRGVidWcKICAgICAgLSBuYW1lOiAiY2hlX2xvZ19sZXZlbCIKICAgICAgICB0aXRs\
ZTogIkNoZSBMb2cgTGV2ZWwiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6\
IGZhbHNlCiAgICAgICAgZGVmYXVsdDogIklORk8iCiAgICAgICAgZGlzcGxheV9ncm91cDogRGVi\
dWcK"



COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb} && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'persistent'/'prod'/g" && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'ephemeral'/'dev'/g"

USER root
RUN yum install dmidecode -y

USER apb

