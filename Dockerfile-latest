FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBlY2xpcHNlLWNoZS1hcGIKZGVzY3JpcHRpb246IEVjbGlw\
c2UgQ2hlCmJpbmRhYmxlOiBmYWxzZQphc3luYzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgcHJvdmlk\
ZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHBz\
Oi8vd3d3LmVjbGlwc2Uub3JnL2NoZS9kb2NzLzYvY2hlL2RvY3MvIgogIGltYWdlVXJsOiA+LQog\
ICAgaHR0cHM6Ly9naXRodWIuY29tL2VjbGlwc2UvY2hlLWRvY3MvcmF3L21hc3Rlci9zcmMvbWFp\
bi9pbWFnZXMvY2hlX2xvZ28ucG5nCiAgbG9uZ0Rlc2NyaXB0aW9uOiAiQW4gQVBCIGRlcGxveXMg\
RWNsaXBzZSBDaGUgdjYueCB3aXRoIHBlcnNpc3RlbnQgc3RvcmFnZSIKICBkaXNwbGF5TmFtZTog\
IkVjbGlwc2UgQ2hlIChBUEIpIgogIGRlcGVuZGVuY2llczoKICAgIC0gImRvY2tlci5pby9lY2xp\
cHNlL2NoZS1zZXJ2ZXI6bmlnaHRseSIKICAgIC0gImRvY2tlci5pby9qYm9zcy9rZXljbG9hay1v\
cGVuc2hpZnQ6My40LjMuRmluYWwiCiAgICAtICJkb2NrZXIuaW8vcmhzY2wvcG9zdGdyZXNxbC05\
Ni1yaGVsNzpsYXRlc3QiCnBsYW5zOgogIC0gbmFtZTogcHJvZAogICAgZGVzY3JpcHRpb246IFBl\
cnNpc3RlbnQgZGVwbG95bWVudCBvZiBFY2xpcHNlIENoZQogICAgZnJlZTogdHJ1ZQogICAgbWV0\
YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBQcm9kdWN0aW9uCiAgICAgIGxvbmdEZXNjcmlwdGlv\
bjogIlRoaXMgcGxhbiBkZXBsb3lzIEVjbGlwc2UgQ2hlIHdpdGggcGVyc2lzdGVudCBzdG9yYWdl\
LiIKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gbmFtZTogImNoZV9pbWFnZV90YWciCiAgICAgICAg\
dGl0bGU6IENoZSBTZXJ2ZXIgSW1hZ2UgVGFnCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVu\
dW06IFsibmlnaHRseS1jZW50b3MiLCAibmlnaHRseSIsICJsYXRlc3QtY2VudG9zIiwgImxhdGVz\
dCJdCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogIm5pZ2h0bHkiCiAg\
ICAgICAgZGlzcGxheV9ncm91cDogQ2hlIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAiY2hl\
X3NlcnZlcl9kZXBsb3ltZW50X3N0cmFnZXR5IgogICAgICAgIHRpdGxlOiBDaGUgRGVwbG95bWVu\
dCBTdHJhZ2V0eQogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVtOiBbIlJlY3JlYXRlIiwg\
IlJvbGxpbmciXQogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJSZWNy\
ZWF0ZSIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBDaGUgQ29uZmlndXJhdGlvbgogICAgICAtIG5h\
bWU6ICJjaGVfc2VydmVyX2ltYWdlX3B1bGxfcG9saWN5IgogICAgICAgIHRpdGxlOiAiQ2hlIERl\
cGxveW1lbnRDb25maWcgSW1hZ2UgcHVsbCBwb2xpY3kiCiAgICAgICAgdHlwZTogZW51bQogICAg\
ICAgIGVudW06IFsiQWx3YXlzIiwgIklmTm90UHJlc2VudCIsICJOZXZlciJdCiAgICAgICAgcmVx\
dWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogIklmTm90UHJlc2VudCIKICAgICAgICBkaXNw\
bGF5X2dyb3VwOiBDaGUgQ29uZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfcHJlZGVmaW5l\
ZF9zdGFja3NfcmVsb2FkX19vbl9fc3RhcnQiCiAgICAgICAgdGl0bGU6ICJTdGFjayByZWxvYWQg\
b24gc3RhcnQiCiAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAgIGRlZmF1bHQ6IHRydWUKICAg\
ICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dyb3VwOiBDaGUgQ29uZmlndXJh\
dGlvbgogICAgICAtIG5hbWU6ICJjaGVfd29ya3NwYWNlX2F1dG9fc3RhcnQiCiAgICAgICAgdGl0\
bGU6ICJXb3Jrc3BhY2UgYXV0byBzdGFydCIKICAgICAgICB0eXBlOiBib29sZWFuCiAgICAgICAg\
ZGVmYXVsdDogZmFsc2UKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dy\
b3VwOiBDaGUgQ29uZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfa2V5Y2xvYWtfYWRtaW5f\
dXNlcm5hbWUiCiAgICAgICAgdGl0bGU6IEtleWNsb2FrIEFkbWluIFVzZXJuYW1lCiAgICAgICAg\
dHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogImFk\
bWluIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEtleWNsb2FrIENvbmZpZ3VyYXRpb24KICAgICAg\
LSBuYW1lOiAiY2hlX2tleWNsb2FrX2FkbWluX3Bhc3N3b3JkIgogICAgICAgIHRpdGxlOiBLZXlj\
bG9hayBBZG1pbiBQYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVk\
OiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJhZG1pbiIKICAgICAgICBkaXNwbGF5X3R5cGU6IHBh\
c3N3b3JkCiAgICAgICAgZGlzcGxheV9ncm91cDogS2V5Y2xvYWsgQ29uZmlndXJhdGlvbgogICAg\
ICAtIG5hbWU6ICJjaGVfa2V5Y2xvYWtfcmVhbG0iCiAgICAgICAgdGl0bGU6IENoZSBLZXljbG9h\
ayBSZWFsbQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6ICJjaGUiCiAgICAg\
ICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGlzcGxheV9ncm91cDogS2V5Y2xvYWsgQ29uZmln\
dXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfa2V5Y2xvYWtfY2xpZW50X19pZCIKICAgICAgICB0\
aXRsZTogIkNoZSBLZXljbG9hayBDbGllbnQgSWQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgZGVmYXVsdDogImNoZS1wdWJsaWMiCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAg\
ZGlzcGxheV9ncm91cDogS2V5Y2xvYWsgQ29uZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVf\
amRiY19kYl9ob3N0IgogICAgICAgIHRpdGxlOiBEYXRhYmFzZSBob3N0CiAgICAgICAgdHlwZTog\
c3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogInBvc3RncmVz\
IgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBvc3RncmVTUUwgRGF0YWJhc2UgQ29uZmlndXJhdGlv\
bgogICAgICAtIG5hbWU6ICJjaGVfamRiY19kYl9wb3J0IgogICAgICAgIHRpdGxlOiBEYXRhYmFz\
ZSBwb3J0CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAg\
ICAgZGVmYXVsdDogIjU0MzIiCiAgICAgICAgZGlzcGxheV9ncm91cDogUG9zdGdyZVNRTCBEYXRh\
YmFzZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9qZGJjX2RiX25hbWUiCiAgICAg\
ICAgdGl0bGU6IERhdGFiYXNlIG5hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1\
aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiZGJjaGUiCiAgICAgICAgZGlzcGxheV9ncm91\
cDogUG9zdGdyZVNRTCBEYXRhYmFzZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9q\
ZGJjX2RiX3VzZXJuYW1lIgogICAgICAgIHRpdGxlOiBEYXRhYmFzZSB1c2VybmFtZQogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJw\
Z2NoZSIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQb3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3Vy\
YXRpb24KICAgICAgLSBuYW1lOiAiY2hlX2pkYmNfZGJfcGFzc3dvcmQiCiAgICAgICAgdGl0bGU6\
IERhdGFiYXNlIHBhc3N3b3JkIChzZXQgdG8gZGVmYXVsdCBwZ2NoZXBhc3N3b3JkKQogICAgICAg\
IHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJw\
Z2NoZXBhc3N3b3JkIgogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgICBkaXNw\
bGF5X2dyb3VwOiBQb3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1l\
OiAiY2hlX2RhdGFfcHZjX3F1YW50aXR5IgogICAgICAgIHRpdGxlOiAiQ2hlIHNlcnZlciBkYXRh\
IHZvbHVtZSBzaXplIgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxz\
ZQogICAgICAgIGRlZmF1bHQ6ICIxR2kiCiAgICAgICAgZGlzcGxheV9ncm91cDogUGVyc2lzdGVu\
dCBWb2x1bWUKICAgICAgLSBuYW1lOiAiY2hlX2luZnJhX2t1YmVybmV0ZXNfcHZjX3ByZWNyZWF0\
ZV9fc3VicGF0aHMiCiAgICAgICAgdGl0bGU6IFByZWNyZWF0ZSBTdWJwYXRocwogICAgICAgIHR5\
cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiB0cnVl\
CiAgICAgICAgZGlzcGxheV9ncm91cDogUGVyc2lzdGVudCBWb2x1bWUKICAgICAgLSBuYW1lOiAi\
Y2hlX2luZnJhX2t1YmVybmV0ZXNfcHZjX3F1YW50aXR5IgogICAgICAgIHRpdGxlOiBEaXNrIHF1\
YW50aXR5IGZvciBjaGUgd29ya3NwYWNlCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVx\
dWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogIjFHaSIKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBQZXJzaXN0ZW50IFZvbHVtZQogICAgICAtIG5hbWU6ICJjaGVfaW5mcmFfa3ViZXJuZXRlc19w\
dmNfc3RyYXRlZ3kiCiAgICAgICAgdGl0bGU6IENvbW1vbiBvciB1bmlxdWUgdm9sdW1lIGZvciB3\
b3Jrc3BhY2UKICAgICAgICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWyd1bmlxdWUnLCAnY29t\
bW9uJ10KICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAidW5pcXVlIgog\
ICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBlcnNpc3RlbnQgVm9sdW1lCiAgICAgIC0gbmFtZTogImNo\
ZV9pbmZyYV9rdWJlcm5ldGVzX3B2Y19uYW1lIgogICAgICAgIHRpdGxlOiBXb3Jrc3BhY2UgVm9s\
dW1lIE5hbWUgKG9ubHkgaWYgc3RyYXRlZ3kgaXMgY29tbW9uKQogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICIiCiAgICAgICAgZGlz\
cGxheV9ncm91cDogUGVyc2lzdGVudCBWb2x1bWUKICAgICAgLSBuYW1lOiAiY2hlX2RlYnVnX3Nl\
cnZlciIKICAgICAgICB0aXRsZTogRW5hYmxlIENoZSBEZWJ1Z2dpbmcKICAgICAgICB0eXBlOiBi\
b29sZWFuCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBEZWJ1ZwogICAgICAtIG5hbWU6ICJjaGVfbG9nX2xldmVsIgog\
ICAgICAgIHRpdGxlOiAiQ2hlIExvZyBMZXZlbCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiSU5GTyIKICAgICAgICBkaXNwbGF5\
X2dyb3VwOiBEZWJ1Zwo="




COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb} && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'persistent'/'prod'/g" && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'ephemeral'/'dev'/g"

USER apb
