FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBlY2xpcHNlLWNoZS1hcGIKZGVzY3JpcHRpb246IEVjbGlw\
c2UgQ2hlCmJpbmRhYmxlOiBmYWxzZQphc3luYzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgcHJvdmlk\
ZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCiAgZG9jdW1lbnRhdGlvblVybDogImh0dHBz\
Oi8vd3d3LmVjbGlwc2Uub3JnL2NoZS9kb2NzLzYvY2hlL2RvY3MvIgogIGltYWdlVXJsOiA+LQog\
ICAgaHR0cHM6Ly9naXRodWIuY29tL2VjbGlwc2UvY2hlLWRvY3MvcmF3L21hc3Rlci9zcmMvbWFp\
bi9pbWFnZXMvY2hlX2xvZ28ucG5nCiAgbG9uZ0Rlc2NyaXB0aW9uOiAiQW4gQVBCIHRoYXQgZGVw\
bG95cyBFY2xpcHNlIENoZSB2Ni54IHdpdGggcGVyc2lzdGVudCBzdG9yYWdlLiBSZXF1aXJlZCAt\
IFBlcnNpc3RlbnQgVm9sdW1lcywgQVNCIGNvbmZpZ3VyZWQgd2l0aCBzYW5kYm94X3JvbGUgYWRt\
aW4uIFVuc3VwcG9ydGVkIC0gVExTLCBFcGhlbWVyYWwgc3RvcmFnZS4gQWxsIHRoZSBwYXJhbWV0\
ZXJzIGFyZSBkZWZhdWx0ZWQgd2l0aCB0eXBpY2FsIGNvbmZpZ3VyZWQgdmFsdWVzLiIKICBkaXNw\
bGF5TmFtZTogIkVjbGlwc2UgQ2hlIChBUEIpIgogIGRlcGVuZGVuY2llczoKICAgIC0gImRvY2tl\
ci5pby9lY2xpcHNlL2NoZS1zZXJ2ZXI6bmlnaHRseSIKICAgIC0gImRvY2tlci5pby9qYm9zcy9r\
ZXljbG9hay1vcGVuc2hpZnQ6My40LjMuRmluYWwiCiAgICAtICJkb2NrZXIuaW8vcmhzY2wvcG9z\
dGdyZXNxbC05Ni1yaGVsNzpsYXRlc3QiCnBsYW5zOgogIC0gbmFtZTogcHJvZAogICAgZGVzY3Jp\
cHRpb246IFBlcnNpc3RlbnQgZGVwbG95bWVudCBvZiBFY2xpcHNlIENoZQogICAgZnJlZTogdHJ1\
ZQogICAgbWV0YWRhdGE6CiAgICAgIGRpc3BsYXlOYW1lOiBQcm9kdWN0aW9uCiAgICAgIGxvbmdE\
ZXNjcmlwdGlvbjogIlRoaXMgcGxhbiBkZXBsb3lzIEVjbGlwc2UgQ2hlIHdpdGggcGVyc2lzdGVu\
dCBzdG9yYWdlLiBBbGwgdGhlIHBhcmFtZXRlcnMgYXJlIGRlZmF1bHRlZCB3aXRoIHR5cGljYWwg\
Y29uZmlndXJlZCB2YWx1ZXMuIgogICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiAiY2hlX2lt\
YWdlX3RhZyIKICAgICAgICB0aXRsZTogQ2hlIFNlcnZlciBJbWFnZSBUYWcKICAgICAgICB0eXBl\
OiBlbnVtCiAgICAgICAgZW51bTogWyJuaWdodGx5LWNlbnRvcyIsICJuaWdodGx5IiwgImxhdGVz\
dC1jZW50b3MiLCAibGF0ZXN0Il0KICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZh\
dWx0OiAibmlnaHRseSIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBDaGUgQ29uZmlndXJhdGlvbgog\
ICAgICAtIG5hbWU6ICJjaGVfc2VydmVyX2RlcGxveW1lbnRfc3RyYWdldHkiCiAgICAgICAgdGl0\
bGU6IENoZSBEZXBsb3ltZW50IFN0cmFnZXR5CiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVu\
dW06IFsiUmVjcmVhdGUiLCAiUm9sbGluZyJdCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAg\
ICAgZGVmYXVsdDogIlJlY3JlYXRlIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IENoZSBDb25maWd1\
cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9zZXJ2ZXJfaW1hZ2VfcHVsbF9wb2xpY3kiCiAgICAg\
ICAgdGl0bGU6ICJDaGUgRGVwbG95bWVudENvbmZpZyBJbWFnZSBwdWxsIHBvbGljeSIKICAgICAg\
ICB0eXBlOiBlbnVtCiAgICAgICAgZW51bTogWyJBbHdheXMiLCAiSWZOb3RQcmVzZW50IiwgIk5l\
dmVyIl0KICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiSWZOb3RQcmVz\
ZW50IgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IENoZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFt\
ZTogImNoZV9wcmVkZWZpbmVkX3N0YWNrc19yZWxvYWRfX29uX19zdGFydCIKICAgICAgICB0aXRs\
ZTogIlN0YWNrIHJlbG9hZCBvbiBzdGFydCIKICAgICAgICB0eXBlOiBib29sZWFuCiAgICAgICAg\
ZGVmYXVsdDogdHJ1ZQogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRpc3BsYXlfZ3Jv\
dXA6IENoZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV93b3Jrc3BhY2VfYXV0b19z\
dGFydCIKICAgICAgICB0aXRsZTogIldvcmtzcGFjZSBhdXRvIHN0YXJ0IgogICAgICAgIHR5cGU6\
IGJvb2xlYW4KICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIHJlcXVpcmVkOiBmYWxzZQog\
ICAgICAgIGRpc3BsYXlfZ3JvdXA6IENoZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNo\
ZV9rZXljbG9ha19hZG1pbl91c2VybmFtZSIKICAgICAgICB0aXRsZTogS2V5Y2xvYWsgQWRtaW4g\
VXNlcm5hbWUKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAg\
ICAgICBkZWZhdWx0OiAiYWRtaW4iCiAgICAgICAgZGlzcGxheV9ncm91cDogS2V5Y2xvYWsgQ29u\
ZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfa2V5Y2xvYWtfYWRtaW5fcGFzc3dvcmQiCiAg\
ICAgICAgdGl0bGU6IEtleWNsb2FrIEFkbWluIFBhc3N3b3JkCiAgICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogImFkbWluIgogICAgICAg\
IGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBLZXljbG9hayBD\
b25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9rZXljbG9ha19yZWFsbSIKICAgICAgICB0\
aXRsZTogQ2hlIEtleWNsb2FrIFJlYWxtCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVm\
YXVsdDogImNoZSIKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBLZXljbG9hayBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9rZXljbG9ha19jbGll\
bnRfX2lkIgogICAgICAgIHRpdGxlOiAiQ2hlIEtleWNsb2FrIENsaWVudCBJZCIKICAgICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgICBkZWZhdWx0OiAiY2hlLXB1YmxpYyIKICAgICAgICByZXF1aXJl\
ZDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dyb3VwOiBLZXljbG9hayBDb25maWd1cmF0aW9uCiAg\
ICAgIC0gbmFtZTogImNoZV9qZGJjX2RiX2hvc3QiCiAgICAgICAgdGl0bGU6IERhdGFiYXNlIGhv\
c3QKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBk\
ZWZhdWx0OiAicG9zdGdyZXMiCiAgICAgICAgZGlzcGxheV9ncm91cDogUG9zdGdyZVNRTCBEYXRh\
YmFzZSBDb25maWd1cmF0aW9uCiAgICAgIC0gbmFtZTogImNoZV9qZGJjX2RiX3BvcnQiCiAgICAg\
ICAgdGl0bGU6IERhdGFiYXNlIHBvcnQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1\
aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiNTQzMiIKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBQb3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3VyYXRpb24KICAgICAgLSBuYW1lOiAiY2hlX2pk\
YmNfZGJfbmFtZSIKICAgICAgICB0aXRsZTogRGF0YWJhc2UgbmFtZQogICAgICAgIHR5cGU6IHN0\
cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJkYmNoZSIKICAg\
ICAgICBkaXNwbGF5X2dyb3VwOiBQb3N0Z3JlU1FMIERhdGFiYXNlIENvbmZpZ3VyYXRpb24KICAg\
ICAgLSBuYW1lOiAiY2hlX2pkYmNfZGJfdXNlcm5hbWUiCiAgICAgICAgdGl0bGU6IERhdGFiYXNl\
IHVzZXJuYW1lCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAg\
ICAgICAgZGVmYXVsdDogInBnY2hlIgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBvc3RncmVTUUwg\
RGF0YWJhc2UgQ29uZmlndXJhdGlvbgogICAgICAtIG5hbWU6ICJjaGVfamRiY19kYl9wYXNzd29y\
ZCIKICAgICAgICB0aXRsZTogRGF0YWJhc2UgcGFzc3dvcmQgKHNldCB0byBkZWZhdWx0IHBnY2hl\
cGFzc3dvcmQpCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAg\
ICAgICAgZGVmYXVsdDogInBnY2hlcGFzc3dvcmQiCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNz\
d29yZAogICAgICAgIGRpc3BsYXlfZ3JvdXA6IFBvc3RncmVTUUwgRGF0YWJhc2UgQ29uZmlndXJh\
dGlvbgogICAgICAtIG5hbWU6ICJjaGVfZGF0YV9wdmNfcXVhbnRpdHkiCiAgICAgICAgdGl0bGU6\
ICJDaGUgc2VydmVyIGRhdGEgdm9sdW1lIHNpemUiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAg\
ICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVsdDogIjFHaSIKICAgICAgICBkaXNwbGF5\
X2dyb3VwOiBQZXJzaXN0ZW50IFZvbHVtZQogICAgICAtIG5hbWU6ICJjaGVfaW5mcmFfa3ViZXJu\
ZXRlc19wdmNfcHJlY3JlYXRlX19zdWJwYXRocyIKICAgICAgICB0aXRsZTogUHJlY3JlYXRlIFN1\
YnBhdGhzCiAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAg\
ICAgIGRlZmF1bHQ6IHRydWUKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQZXJzaXN0ZW50IFZvbHVt\
ZQogICAgICAtIG5hbWU6ICJjaGVfaW5mcmFfa3ViZXJuZXRlc19wdmNfcXVhbnRpdHkiCiAgICAg\
ICAgdGl0bGU6IERpc2sgcXVhbnRpdHkgZm9yIGNoZSB3b3Jrc3BhY2UKICAgICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBkZWZhdWx0OiAiMUdpIgogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IFBlcnNpc3RlbnQgVm9sdW1lCiAgICAgIC0gbmFtZTogImNoZV9p\
bmZyYV9rdWJlcm5ldGVzX3B2Y19zdHJhdGVneSIKICAgICAgICB0aXRsZTogQ29tbW9uIG9yIHVu\
aXF1ZSB2b2x1bWUgZm9yIHdvcmtzcGFjZQogICAgICAgIHR5cGU6IGVudW0KICAgICAgICBlbnVt\
OiBbJ3VuaXF1ZScsICdjb21tb24nXQogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRl\
ZmF1bHQ6ICJ1bmlxdWUiCiAgICAgICAgZGlzcGxheV9ncm91cDogUGVyc2lzdGVudCBWb2x1bWUK\
ICAgICAgLSBuYW1lOiAiY2hlX2luZnJhX2t1YmVybmV0ZXNfcHZjX25hbWUiCiAgICAgICAgdGl0\
bGU6IFdvcmtzcGFjZSBWb2x1bWUgTmFtZSAob25seSBpZiBzdHJhdGVneSBpcyBjb21tb24pCiAg\
ICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgICAgZGVmYXVs\
dDogIiIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBQZXJzaXN0ZW50IFZvbHVtZQogICAgICAtIG5h\
bWU6ICJjaGVfZGVidWdfc2VydmVyIgogICAgICAgIHRpdGxlOiBFbmFibGUgQ2hlIERlYnVnZ2lu\
ZwogICAgICAgIHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICBk\
ZWZhdWx0OiBmYWxzZQogICAgICAgIGRpc3BsYXlfZ3JvdXA6IERlYnVnCiAgICAgIC0gbmFtZTog\
ImNoZV9sb2dfbGV2ZWwiCiAgICAgICAgdGl0bGU6ICJDaGUgTG9nIExldmVsIgogICAgICAgIHR5\
cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIGRlZmF1bHQ6ICJJTkZP\
IgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IERlYnVnCgo="




COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb} && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'persistent'/'prod'/g" && \
    find /opt/ansible/roles/keycloak-apb -type f | xargs sed -i "s/'ephemeral'/'dev'/g"

USER apb
